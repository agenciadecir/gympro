// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["driverAdapters"]
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id            String         @id @default(cuid())
  email         String         @unique
  name          String?
  password      String?
  image         String?
  role          String         @default("USER")
  isActive      Boolean        @default(true)
  bannedAt      DateTime?
  lastLoginAt   DateTime?
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  routines      Routine[]
  progress      PhysicalProgress[]
  diets         Diet[]
  recipes       Recipe[]
  activeRoutine Routine?       @relation("ActiveRoutine", fields: [activeRoutineId], references: [id])
  activeRoutineId String?      @unique
  activeDiet    Diet?          @relation("ActiveDiet", fields: [activeDietId], references: [id])
  activeDietId  String?        @unique
}

model Routine {
  id          String       @id @default(cuid())
  name        String
  description String?
  isActive    Boolean      @default(false)
  isArchived  Boolean      @default(false)
  aiAnalysis  String?
  userId      String
  user        User         @relation(fields: [userId], references: [id])
  days        WorkoutDay[]
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  activeForUser User?      @relation("ActiveRoutine")
}

model WorkoutDay {
  id           String      @id @default(cuid())
  name         String
  dayNumber    Int
  routineId    String
  routine      Routine     @relation(fields: [routineId], references: [id], onDelete: Cascade)
  exercises    Exercise[]
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
}

model Exercise {
  id            String      @id @default(cuid())
  name          String
  muscleGroup   String?
  thumbnailUrl  String?
  sets          Int?
  reps          String?
  weight        Float?
  weightUnit    String      @default("kg")
  notes         String?
  order         Int         @default(0)
  workoutDayId  String
  workoutDay    WorkoutDay  @relation(fields: [workoutDayId], references: [id], onDelete: Cascade)
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
}

model PhysicalProgress {
  id              String    @id @default(cuid())
  date            DateTime  @default(now())
  bodyWeight      Float?
  backMeasurement Float?
  chestMeasurement Float?
  leftArmMeasurement Float?
  rightArmMeasurement Float?
  abdomenMeasurement Float?
  glutesMeasurement Float?
  rightLegMeasurement Float?
  leftLegMeasurement Float?
  frontPhoto      String?
  sidePhoto       String?
  backPhoto       String?
  extraPhoto      String?
  notes           String?
  userId          String
  user            User      @relation(fields: [userId], references: [id])
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
}

model Diet {
  id            String      @id @default(cuid())
  name          String
  description   String?
  isActive      Boolean     @default(false)
  isArchived    Boolean     @default(false)
  dietType      String?     @default("training_day")
  startDate     DateTime?
  endDate       DateTime?
  totalCalories Float?
  totalProtein  Float?
  totalCarbs    Float?
  totalFat      Float?
  totalFiber    Float?
  vitaminA      Float?
  vitaminC      Float?
  vitaminD      Float?
  calcium       Float?
  iron          Float?
  userId        String
  user          User        @relation(fields: [userId], references: [id])
  meals         Meal[]
  activeForUser User?       @relation("ActiveDiet")
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
}

model Meal {
  id          String      @id @default(cuid())
  mealType    String
  name        String?
  description String?
  time        String?
  calories    Float?
  protein     Float?
  carbs       Float?
  fat         Float?
  fiber       Float?
  dietId      String
  diet        Diet        @relation(fields: [dietId], references: [id], onDelete: Cascade)
  items       MealItem[]
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
}

model MealItem {
  id          String    @id @default(cuid())
  name        String
  quantity    Float
  unit        String    @default("g")
  calories    Float?
  protein     Float?
  carbs       Float?
  fat         Float?
  fiber       Float?
  mealId      String
  meal        Meal      @relation(fields: [mealId], references: [id], onDelete: Cascade)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model Recipe {
  id            String    @id @default(cuid())
  name          String
  description   String?
  instructions  String
  ingredients   String
  servings      Int       @default(1)
  prepTime      Int?
  cookTime      Int?
  calories      Float?
  protein       Float?
  carbs         Float?
  fat           Float?
  imageUrl      String?
  isAiGenerated Boolean   @default(false)
  userId        String
  user          User      @relation(fields: [userId], references: [id])
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}